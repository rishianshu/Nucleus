import type { EndpointTemplate } from "../types.js";

export const DEFAULT_ENDPOINT_TEMPLATES: EndpointTemplate[] = [
  {
    id: "jdbc.postgres",
    family: "JDBC",
    title: "PostgreSQL",
    vendor: "PostgreSQL",
    description: "Register a PostgreSQL instance via JDBC so collections can profile schemas and datasets.",
    domain: "metadata.endpoint.jdbc",
    categories: ["database", "warehouse"],
    protocols: ["jdbc"],
    versions: ["12.x", "13.x", "14.x", "15.x"],
    descriptorVersion: "1.0.0",
    defaultPort: 5432,
    driver: "org.postgresql.Driver",
    docsUrl: "https://www.postgresql.org/docs/current/libpq-connect.html",
    defaultLabels: ["template:jdbc", "template:postgres"],
    fields: [
      {
        key: "host",
        label: "Host",
        required: true,
        valueType: "TEXT",
        placeholder: "localhost",
        description: "Hostname or IP for your Postgres instance.",
      },
      {
        key: "port",
        label: "Port",
        required: true,
        valueType: "PORT",
        defaultValue: "5432",
      },
      {
        key: "database",
        label: "Database",
        required: true,
        valueType: "TEXT",
        placeholder: "postgres",
      },
      {
        key: "username",
        label: "Username",
        required: true,
        valueType: "TEXT",
      },
      {
        key: "password",
        label: "Password",
        required: true,
        valueType: "PASSWORD",
        sensitive: true,
      },
      {
        key: "schemas",
        label: "Schemas",
        required: false,
        valueType: "TEXT",
        placeholder: "public",
        helpText: "Comma-separated schemas to include. Leave blank for all.",
      },
      {
        key: "role",
        label: "Role",
        required: false,
        valueType: "TEXT",
        description: "Optional Postgres role to assume after connecting.",
      },
      {
        key: "ssl_mode",
        label: "SSL mode",
        required: false,
        valueType: "ENUM",
        options: [
          { label: "Disable", value: "disable" },
          { label: "Prefer", value: "prefer" },
          { label: "Require", value: "require" },
          { label: "Verify CA", value: "verify-ca" },
          { label: "Verify Full", value: "verify-full" },
        ],
        defaultValue: "prefer",
      },
      {
        key: "ssl_root_cert",
        label: "SSL root cert",
        required: false,
        valueType: "TEXT",
        description: "Base64 or path to the CA certificate.",
        advanced: true,
      },
      {
        key: "ssl_client_cert",
        label: "SSL client cert",
        required: false,
        valueType: "TEXT",
        advanced: true,
      },
      {
        key: "ssl_client_key",
        label: "SSL client key",
        required: false,
        valueType: "TEXT",
        advanced: true,
      },
      {
        key: "application_name",
        label: "Application name",
        required: false,
        valueType: "TEXT",
        advanced: true,
      },
      {
        key: "connect_timeout_ms",
        label: "Connect timeout (ms)",
        required: false,
        valueType: "NUMBER",
        advanced: true,
      },
      {
        key: "statement_timeout_ms",
        label: "Statement timeout (ms)",
        required: false,
        valueType: "NUMBER",
        advanced: true,
      },
      {
        key: "additional_parameters",
        label: "Additional parameters",
        required: false,
        valueType: "TEXT",
        placeholder: "search_path=public",
        advanced: true,
      },
      {
        key: "version_hint",
        label: "Version hint",
        required: false,
        valueType: "TEXT",
        advanced: true,
      },
    ],
    capabilities: [
      {
        key: "metadata",
        label: "Metadata collection",
        description: "Enables schema and dataset discovery for catalog views.",
      },
      {
        key: "preview",
        label: "Dataset preview",
        description: "Allow dataset preview queries when supported by the agent.",
      },
    ],
    sampleConfig: {
      templateId: "jdbc.postgres",
      parameters: {
        host: "localhost",
        port: "5432",
        database: "jira_plus_plus",
        username: "postgres",
        password: "postgres",
        schemas: "public",
        role: "",
        ssl_mode: "prefer",
        ssl_root_cert: "",
        ssl_client_key: "",
        ssl_client_cert: "",
        application_name: "",
        connect_timeout_ms: "",
        statement_timeout_ms: "",
        version_hint: "",
        additional_parameters: "",
      },
    },
    connection: {
      urlTemplate: "jdbc:postgresql://{{host}}:{{port}}/{{database}}",
      defaultVerb: "GET",
    },
  },
  {
    id: "jira.http",
    family: "HTTP",
    title: "Jira",
    vendor: "Atlassian",
    description: "Connect to Jira Cloud/Server REST APIs for semantic ingestion.",
    domain: "work.jira",
    categories: ["work-management", "semantic"],
    protocols: ["https"],
    versions: [],
    descriptorVersion: "1.0.0",
    docsUrl: "https://developer.atlassian.com/cloud/jira/platform/rest/v3/",
    agentPrompt: "Collect the Jira base URL (https://<domain>.atlassian.net), authentication method, and optional project filters.",
    defaultLabels: ["jira", "semantic"],
    fields: [
      {
        key: "base_url",
        label: "Base URL",
        required: true,
        valueType: "URL",
        placeholder: "https://your-domain.atlassian.net",
        description: "Root Jira URL without trailing slash.",
      },
      {
        key: "auth_type",
        label: "Authentication",
        required: true,
        valueType: "ENUM",
        defaultValue: "basic",
        options: [
          { label: "Basic (email + API token)", value: "basic" },
          { label: "Personal access token", value: "pat" },
          { label: "OAuth 2.0 client", value: "oauth" },
        ],
      },
      {
        key: "username",
        label: "Username / Email",
        required: false,
        valueType: "TEXT",
        placeholder: "agent@example.com",
        description: "Jira account email used with basic authentication.",
      },
      {
        key: "api_token",
        label: "API token / Password",
        required: false,
        valueType: "PASSWORD",
        sensitive: true,
        description: "API token (for basic auth) or PAT.",
      },
      {
        key: "oauth_client_id",
        label: "OAuth client id",
        required: false,
        valueType: "TEXT",
        advanced: true,
      },
      {
        key: "oauth_client_secret",
        label: "OAuth client secret",
        required: false,
        valueType: "PASSWORD",
        sensitive: true,
        advanced: true,
      },
      {
        key: "project_keys",
        label: "Project keys",
        required: false,
        valueType: "TEXT",
        placeholder: "ENG,OPS",
        description: "Optional comma-separated project keys to limit scope.",
      },
      {
        key: "jql_filter",
        label: "JQL filter",
        required: false,
        valueType: "TEXT",
        advanced: true,
        description: "Additional JQL applied to issue ingestion requests.",
      },
    ],
    capabilities: [
      {
        key: "metadata",
        label: "Semantic metadata",
        description: "Collects Jira semantic datasets (projects, issues, users).",
      },
      {
        key: "ingest.incremental",
        label: "Incremental ingestion",
        description: "Supports updated-since pagination for issues.",
      },
      {
        key: "ingest.full",
        label: "Full ingestion",
        description: "Projects can be re-synced in full when needed.",
      },
    ],
    sampleConfig: {
      templateId: "jira.http",
      parameters: {
        base_url: "https://example.atlassian.net",
        auth_type: "basic",
        username: "agent@example.com",
        api_token: "token",
        oauth_client_id: "",
        oauth_client_secret: "",
        project_keys: "ENG",
        jql_filter: "",
      },
    },
    connection: {
      urlTemplate: "{{base_url}}",
      defaultVerb: "GET",
    },
    extras: {
      apiCatalog: [
        { key: "project_search", method: "GET", path: "/rest/api/3/project/search", description: "List accessible projects", docUrl: "https://developer.atlassian.com/cloud/jira/platform/rest/v3/api-group-projects/#api-rest-api-3-project-search-get", scope: "projects" },
        { key: "issue_search", method: "GET", path: "/rest/api/3/search/jql", description: "Search issues via JQL", docUrl: "https://developer.atlassian.com/cloud/jira/platform/rest/v3/api-group-issue-search/#api-rest-api-3-search-jql-post", scope: "issues" },
        { key: "user_search", method: "GET", path: "/rest/api/3/user/search", description: "Search users by query", docUrl: "https://developer.atlassian.com/cloud/jira/platform/rest/v3/api-group-users/#api-rest-api-3-user-search-get", scope: "users" },
      ],
      ingestionUnits: [
        {
          unitId: "jira.projects",
          datasetId: "jira.projects",
          kind: "dataset",
          displayName: "Projects",
          description: "Project catalog (key, name, lead, type).",
          supportsIncremental: false,
          cdmModelId: "cdm.work.project",
        },
        {
          unitId: "jira.issues",
          datasetId: "jira.issues",
          kind: "dataset",
          displayName: "Issues",
          description: "Work items (issues/epics/tasks) with incremental sync.",
          supportsIncremental: true,
          defaultPolicy: { cursor: "fields.updated" },
          cdmModelId: "cdm.work.item",
        },
        {
          unitId: "jira.users",
          datasetId: "jira.users",
          kind: "dataset",
          displayName: "Users",
          description: "Directory of Jira users referenced by work items.",
          supportsIncremental: false,
          cdmModelId: "cdm.work.user",
        },
        {
          unitId: "jira.comments",
          datasetId: "jira.comments",
          kind: "dataset",
          displayName: "Comments",
          description: "Issue comments with incremental sync on updated timestamp.",
          supportsIncremental: true,
          defaultPolicy: { cursor: "updated" },
          cdmModelId: "cdm.work.comment",
        },
        {
          unitId: "jira.worklogs",
          datasetId: "jira.worklogs",
          kind: "dataset",
          displayName: "Worklogs",
          description: "Time tracking entries recorded against issues.",
          supportsIncremental: true,
          defaultPolicy: { cursor: "started" },
          cdmModelId: "cdm.work.worklog",
        },
      ],
    },
  },
  {
    id: "cdm.jdbc",
    family: "JDBC",
    title: "CDM Postgres Sink",
    vendor: "PostgreSQL",
    description: "Provision and manage CDM work tables in Postgres for semantic ingestion sinks.",
    domain: "cdm.work",
    categories: ["cdm", "sink"],
    protocols: ["jdbc"],
    versions: ["12.x", "13.x", "14.x", "15.x"],
    descriptorVersion: "1.0.0",
    defaultPort: 5432,
    defaultLabels: ["template:jdbc", "sink:cdm"],
    fields: [
      {
        key: "connection_url",
        label: "Connection URL",
        required: true,
        valueType: "TEXT",
        description: "Postgres connection string (postgres://user:pass@host:port/database).",
      },
      {
        key: "schema",
        label: "Schema",
        required: true,
        valueType: "TEXT",
        placeholder: "cdm_work",
        semantic: "SCHEMA",
      },
      {
        key: "table_prefix",
        label: "Table prefix",
        required: false,
        valueType: "TEXT",
        placeholder: "cdm_",
        helpText: "Optional prefix when autoprovisioning CDM tables.",
      },
      {
        key: "ssl_mode",
        label: "SSL mode",
        required: false,
        valueType: "ENUM",
        options: [
          { label: "Disable", value: "disable" },
          { label: "Prefer", value: "prefer" },
          { label: "Require", value: "require" },
          { label: "Verify CA", value: "verify-ca" },
          { label: "Verify Full", value: "verify-full" },
        ],
        defaultValue: "prefer",
        advanced: true,
      },
    ],
    capabilities: [
      {
        key: "sink.cdm",
        label: "CDM sink",
        description: "Accepts CDM work records when ingestion runs in CDM mode.",
      },
      {
        key: "sink.autoprovision",
        label: "Autoprovision tables",
        description: "Supports provisioning CDM tables per model.",
      },
    ],
    sampleConfig: {
      templateId: "cdm.jdbc",
      parameters: {
        connection_url: "postgres://postgres:postgres@localhost:5432/jira_plus_plus",
        schema: "cdm_work",
        table_prefix: "cdm_",
        ssl_mode: "prefer",
      },
    },
    extras: {
      supportedCdmModels: ["cdm.work.project", "cdm.work.user", "cdm.work.item", "cdm.work.comment", "cdm.work.worklog"],
      defaultSchema: "cdm_work",
    },
  },
];
